<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>In hình ảnh theo trang</title>
  <style>
    body {
      font-family: Arial;
    }

    .gallery {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 20px;
    }

    .image-container {
      position: relative;
      width: 200px;
      border: 1px solid #ccc;
      padding: 8px;
    }

    .image-container img {
      width: 100%;
      height: auto;
    }

    .tooltip-select {
      position: absolute;
      top: 8px;
      right: 8px;
      background: rgba(255, 255, 255, 0.9);
      padding: 2px 6px;
      font-size: 12px;
      border-radius: 4px;
    }

    #print-section {
      display: none;
    }

    body.printing .gallery,
    body.printing .no-print,
    body.printing .settings {
      display: none !important;
    }

    body.printing #print-section {
      display: block;
    }

    .settings {
      margin-bottom: 16px;
    }

    @media print {
	#app {
		display: none !important;
	  }
	
	  html, body {
		margin: 0;
		padding: 0;
		width: 100%;
		height: 100%;
	  }

	  .shared-group,
	  .solo-image {
		width: 100%;
		height: 100vh;
		padding: 12px;
		box-sizing: border-box;
		break-inside: avoid;
	  }

	  .shared-group:not(:last-of-type),
	  .solo-image:not(:last-of-type) {
		page-break-after: always;
	  }

	  .shared-group.count-4 {
		display: grid;
		grid-template-columns: 1fr 1fr;
		grid-template-rows: 1fr 1fr;
		gap: 8px;
	  }

	  .shared-group.count-3 {
		display: grid;
		grid-template-columns: 1fr 1fr;
		grid-template-rows: 1fr 1fr;
		gap: 8px;
	  }

	  <!-- .shared-group.count-3 .print-image:nth-child(3) { -->
		<!-- grid-column: span 2; -->
	  <!-- } -->

	  .shared-group.count-2 {
		display: grid;
		grid-template-columns: 1fr;
		grid-template-rows: 1fr 1fr;
		gap: 8px;
	  }

	  .shared-group.count-1 {
		display: flex;
		justify-content: center;
		align-items: center;
	  }
	  
	  .print-image.empty {
		  background-color: white;
		  border: none;
		}

	  .print-image {
		display: flex;
		justify-content: center;
		align-items: center;
		width: 100%;
		height: 100%;
	  }

	  .print-image img {
		width: 100%;
		height: 100%;
		object-fit: contain;
	  }
	  
	  .solo-image {
		  display: flex;
		  justify-content: center;     /* Căn giữa ngang */
		  align-items: center;         /* ✅ Căn giữa dọc */
		  width: 100%;
		  height: 100vh;
		  padding: 0;
		  margin: 0;
		  box-sizing: border-box;
		}
	  .solo-image img {
		width: 100%;
		height: 100%;
		object-fit: contain;
	  }
	}


  </style>
</head>
<body>
	<div id="app">
  <h2 class="no-print">Demo In Hình Ảnh Tuỳ Số Lượng</h2>

  <div class="settings no-print">
    <label>
      Số hình/trang (nếu không in riêng): 
      <select id="imagesPerPage">
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4" selected>4</option>
      </select>
    </label>
    <button onclick="preparePrint()">In</button>
  </div>

  <div class="gallery no-print">
    <!-- 10 hình demo -->
    <script>
      for (let i = 1; i <= 10; i++) {
        document.write(`
          <div class="image-container" data-print-alone="false">
            <img src="https://cdn.tgdd.vn/hoi-dap/1355633/kich-thuoc-kho-giay-a4-la-bao-nhieu-cach-chon-in-giay-a4%203.jpg" alt="Ảnh ${i}">
            <label class="tooltip-select">
              <input type="checkbox" onchange="toggleAlone(this)">
              In riêng
            </label>
          </div>
        `);
      }
    </script>
  </div>
</div>
  <div id="print-section"></div>

  <script>
    function toggleAlone(checkbox) {
      const container = checkbox.closest('.image-container');
      container.setAttribute('data-print-alone', checkbox.checked ? 'true' : 'false');
    }

    function preparePrint() {
      const imagesPerPage = parseInt(document.getElementById('imagesPerPage').value) || 4;

      const allImages = document.querySelectorAll('.image-container');
      let shared = [];
      let solo = [];

      allImages.forEach(container => {
        const img = container.querySelector('img');
        const src = img.src;
        const isAlone = container.getAttribute('data-print-alone') === 'true';
        const html = `<div class="print-image"><img src="${src}" alt=""></div>`;
        if (isAlone) solo.push(html);
        else shared.push(html);
      });

      let content = ``;

      for (let i = 0; i < shared.length; i += imagesPerPage) {
        const group = shared.slice(i, i + imagesPerPage);
		  // Nếu là nhóm 3 hình trong layout 4 → thêm ô trống để đủ 4
		  if (imagesPerPage === 3 && group.length === 3) {
			group.push('<div class="print-image empty"></div>'); // Thêm ô trống
		  }
		  content += `<div class="shared-group count-${imagesPerPage}">${group.join('')}</div>`;
      }

      solo.forEach(img => {
        content += `<div class="solo-image">${img}</div>`;
      });

      const printSection = document.getElementById('print-section');
      printSection.innerHTML = content.trim();
      document.body.classList.add('printing');

      setTimeout(() => {
        window.print();
        setTimeout(() => {
          document.body.classList.remove('printing');
          printSection.innerHTML = '';
        }, 500);
      }, 50);
    }
  </script>
</body>
</html>
